### 渲染过程中遇到 JS 文件怎么处理？

JavaScript 的加载、解析与执行会阻塞文档的解析，也就是说，在构建 DOM 时，HTML 解析器若遇到了
JavaScript，将控制权交给 JavaScript 引擎，等 JavaScript 引擎运行完毕，浏览器再从中断的地方恢
复继续解析文档。
也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件，这也是都建议将`script`标签放在`body`标签底部的原因。当然并不是说，script 标签必须放在底部，`script`标签添加`defer`或者`async`属性。

### async 和 defer 的作用是什么？

- 脚本没有`defer`或`async`，浏览器会立即加载并执行指定的脚本，也就是说不等待后续载入的文档元素，读到就加载并执行。
- `defer`属性表示延迟执行引入的JavaScript，即这段JavaScript加载时HTML并未停止解析，这两个过程是并行的。当整个document解析完毕后再执行脚本文件，在DOMContentLoaded事件触发之前完成。多个脚本按顺序执行。
- `async`属性表示异步执行引入的JavaScript，与`defer`的区别在于，如果已经加载好，就会开始执行，也就是说它的执行仍然会阻塞文档的解析，只是它的加载过程不会阻塞。多个脚本的执行顺序无法保证。

### 文档的预解析
WebKit 和 Firefox 都进行了【预解析】这项优化。当执行JavaScript脚本时，另一个线程解析剩下的文档，并加载后面需要通过网络加载的资源。
这种方式可以使资源并行加载从而使整体速度更快，需要注意的是，预解析并不会改变DOM树，
它将这个工作留给主解析过程，自己只解析外部资源的引用，比如外部脚本、样式表及图片。

### CSS阻塞
`只有link引入的外部CSS才能够产生阻塞。`
1. `style标签`中的样式：
- 有HTML解析器进行解析
- 不阻塞浏览器渲染（可能会产生"闪屏现象"）
- 不阻塞DOM解析
2. `link引入`的外部css样式
- 由CSS解析器进行解析
- 阻塞浏览器渲染（可以用来处理“闪屏的现象”）
- 阻塞其后面的JS语句的运行
- 不阻塞DOM解析

### JS阻塞
1. 阻塞DOM解析：浏览器不知道后续脚本的内容，如果先去解析了下面的DOM，而随后的js删除了后面所有的DOM，那么浏览器就做了无用功，浏览器无法预估脚本里面具体做了什么操作，例如像document.write这种操作，索性全部停住，等脚本执行完了，浏览器再继续向下解析DOM。
2. 阻塞页面渲染：js中也可以给DOM设置样式，浏览器同样等该脚本执行完毕，再继续干活，避免做无用功。
3. 阻塞后续JS的执行

`无论css阻塞，还是js阻塞，都不会阻塞浏览器加载外部资源（图片、视频、样式、脚本等）。无论是：图片、样式、脚本，都会先发送请求去获取资源，至于资源到本地之后什么时候用，由浏览器自己协调。`