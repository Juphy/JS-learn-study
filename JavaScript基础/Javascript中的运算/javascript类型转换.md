## 显式转换

通过手动进行类型转换，Javascript 提供了以下转型函数：

- 转换为数值类型：Number(mix)、parseInt(string,radix)、parseFloat(string)
- 转换为字符串类型：toString(radix)、String(mix)
- 转换为布尔类型：Boolean(mix)

> 1、Number(mix)函数，可以将任意类型的参数 mix 转换为数值类型。其规则为：

- （1）如果是布尔值，true 和 false 分别被转换为 1 和 0
- （2）如果是数字值，返回本身。
- （3）如果是 null，返回 0.
- （4）如果是 undefined，返回 NaN。
- （5）如果是字符串，遵循以下规则：
  - 1、如果字符串中只包含数字，则将其转换为十进制（忽略前导 0）
  - 2、如果字符串中包含有效的浮点格式，将其转换为浮点数值（忽略前导 0）
  - 3、如果是空字符串，将其转换为 0
  - 4、如果字符串中包含非以上格式，则将其转换为 NaN
- （6）如果是对象，则调用对象的 valueOf()方法，然后依据前面的规则转换返回的值。如果转换的结果是 NaN，则调用对象的 toString()方法，再次依照前面的规则转换返回的字符串值。

下表列出了对象的 valueOf()的返回值：

| 对象     | 返回值                                                                                                       |
| :------- | :----------------------------------------------------------------------------------------------------------- |
| Array    | 数组的元素被转换为字符串，这些字符串由逗号分隔，连接在一起。其操作与 Array.toString 和 Array.join 方法相同。 |
| Boolean  | Boolean 值。                                                                                                 |
| Date     | 存储的时间是从 1970 年 1 月 1 日午夜开始计的毫秒数 UTC。                                                     |
| Function | 函数本身。                                                                                                   |
| Number   | 数字值。                                                                                                     |
| Object   | 对象本身。这是默认情况。 "[object Object]"                                                                   |
| String   | 字符串值。                                                                                                   |

> 2、parseInt(string, radix)函数，将字符串转换为整数类型的数值。它也有一定的规则：

- 将其它进制的数字转为十进制数
- （1）忽略字符串前面的空格，直至找到第一个非空字符
- （2）如果第一个字符不是数字符号或者负号，返回 NaN
- （3）如果第一个字符是数字，则继续解析直至字符串解析完毕或者遇到一个非数字符号为止。数字执行ToString操作进行转换为字符串，然后该字符串解析为整数值。
```
parseInt(0.5);      // => 0
parseInt(0.05);     // => 0
parseInt(0.005);    // => 0
parseInt(0.0005);   // => 0
parseInt(0.00005);  // => 0
parseInt(0.000005); // => 0
parseInt(0.0000005); // => 5

String(0.5);      // => '0.5'
String(0.05);     // => '0.05'
String(0.005);    // => '0.05'
String(0.0005);   // => '0.005' 
String(0.00005);  // => '0.00005'
String(0.000005); // => '0.000005'
String(0.0000005);// => '5e-7'
```
- （4）如果上步解析的结果以 0 开头，则将其当作八进制来解析；如果以 0x 开头，则将其当作十六进制来解析
- （5）如果指定 radix 参数，则以 radix 为基数进行解析

> 3、parseFloat(string)函数，将字符串转换为浮点数类型的数值。

它的规则与 parseInt 基本相同，但也有点区别：字符串中第一个小数点符号是有效的，另外 parseFloat 会忽略所有前导 0，如果字符串包含一个可解析为整数的数，则返回整数值而不是浮点数值。

> 4、toString(radix)方法。除 undefined 和 null 之外的所有类型的值都具有 toString()方法，其作用是返回对象的字符串表示。可以将二进制数字转为其他进制的数字。

| 对象     | 操作                                                                                                                 |
| :------- | :------------------------------------------------------------------------------------------------------------------- |
| Array    | 将 Array 的元素转换为字符串。结果字符串由逗号分隔，且连接起来。                                                      |
| Boolean  | 如果 Boolean 值是 true，则返回 “true”。否则，返回 “false”。                                                          |
| Date     | 返回日期的文字表示法。                                                                                               |
| Error    | 返回一个包含相关错误信息的字符串。                                                                                   |
| Function | 返回如下格式的字符串，其中 functionname 是被调用 toString 方法函数的名称：function functionname( ) { [native code] } |
| Number   | 返回数字的文字表示。                                                                                                 |
| String   | 返回 String 对象的值。                                                                                               |
| 默认     | 返回 “[object objectname]”，其中 objectname 是对象类型的名称。                                                       |

> 5、String(mix)函数，将任何类型的值转换为字符串，其规则为：

- （1）如果有 toString()方法，则调用该方法（不传递 radix 参数）并返回结果
- （2）如果是 null，返回”null”
- （3）如果是 undefined，返回”undefined”

> 6、Boolean(mix)函数，将任何类型的值转换为布尔值。

以下值会被转换为 false：false、”"、0、NaN、null、undefined，其余任何值都会被转换为 true。

## 隐式转换

在某些情况下，即使我们不提供显示转换，Javascript 也会进行自动类型转换，主要情况有：

> 1、于检测是否为非数值的函数：isNaN(mix)

isNaN()函数，经测试发现，该函数会尝试将参数值用 Number()进行转换，如果结果为“非数值”则返回 true，否则返回 false。

> 2、递增递减操作符（包括前置和后置）、一元正负符号操作符

这些操作符适用于任何数据类型的值，针对不同类型的值，该操作符遵循以下规则（经过对比发现，其规则与 Number()规则基本相同）：

- （1）如果是包含有效数字字符的字符串，先将其转换为数字值（转换规则同 Number()），在执行加减 1 的操作，字符串变量变为数值变量。
- （2）如果是不包含有效数字字符的字符串，将变量的值设置为 NaN，字符串变量变成数值变量。
- （3）如果是布尔值 false，先将其转换为 0 再执行加减 1 的操作，布尔值变量编程数值变量。
- （4）如果是布尔值 true，先将其转换为 1 再执行加减 1 的操作，布尔值变量变成数值变量。
- （5）如果是浮点数值，执行加减 1 的操作。
- （6）如果是对象，先调用对象的 valueOf()方法，然后对该返回值应用前面的规则。如果结果是 NaN，则调用 toString()方法后再应用前面的规则。对象变量变成数值变量。

> 3、 加法运算操作符

加号运算操作符在 Javascript 也用于字符串连接符，所以加号操作符的规则分两种情况：

- 如果两个操作值都是数值，其规则为：
  - (1)如果一个操作数为 NaN，则结果为 NaN
  - (2)如果是 Infinity+Infinity，结果是 Infinity
  - (3)如果是-Infinity+(-Infinity)，结果是-Infinity
  - (4)如果是 Infinity+(-Infinity)，结果是 NaN
  - (5)如果是+0+(+0)，结果为+0
  - (6)如果是(-0)+(-0)，结果为-0
  - (7)如果是(+0)+(-0)，结果为+0
- 如果有一个操作值为字符串，则： - 如果两个操作值都是字符串，则将它们拼接起来 - 如果只有一个操作值为字符串，则将另外操作值转换为字符串，然后拼接起来 - 如果一个操作数是对象、数组或者布尔值，则调用 toString()方法取得字符串值，然后再应用前面的字符串规则。对于 undefined 和 null，分别调用 String()显式转换为字符串。

在加法运算中，如果有一个操作值为字符串类型，则将另一个操作值转换为字符串，最后连接起来。

> 4、 乘除、减号运算符、取模运算符

这些操作符针对的是运算，所以他们具有共同性：如果操作值之一不是数值，则被隐式调用 Number()函数进行转换。具体每一种运算的详细规则请参考 ECMAScript 中的定义。

> 5、 逻辑操作符（!、&&、||）

- 逻辑非（！）操作符首先通过 Boolean()函数将它的操作值转换为布尔值，然后求反。
- 逻辑与（&&）操作符，如果一个操作值不是布尔值时，遵循以下规则进行转换：
  - （1）如果第一个操作数经 Boolean()转换后为 true，则返回第二个操作值，否则返回第一个值（不是 Boolean()转换后的值）
  - （2）如果有一个操作值为 null，返回 null
  - （3）如果有一个操作值为 NaN，返回 NaN
  - （4）如果有一个操作值为 undefined，返回 undefined
- 逻辑或（||）操作符，如果一个操作值不是布尔值，遵循以下规则： - （1）如果第一个操作值经 Boolean()转换后为 false，则返回第二个操作值，否则返回第一个操作值（不是 Boolean()转换后的值） - （2）对于 undefined、null 和 NaN 的处理规则与逻辑与（&&）相同

> 6、 关系操作符（<, >, <=, >=）

与上述操作符一样，关系操作符的操作值也可以是任意类型的，所以使用非数值类型参与比较时也需要系统进行隐式类型转换：
（1）如果两个操作值都是数值，则进行数值比较
（2）如果两个操作值都是字符串，则比较字符串对应的字符编码值
（3）如果只有一个操作值是数值，则将另一个操作值转换为数值，进行数值比较
（4）如果一个操作数是对象，则调用 valueOf()方法（如果对象没有 valueOf()方法则调用 toString()方法），得到的结果按照前面的规则执行比较
（5）如果一个操作值是布尔值，则将其转换为数值，再进行比较
注：NaN 是非常特殊的值，它不和任何类型的值相等，包括它自己，同时它与任何类型的值比较大小时都返回 false。

> 7、 相等操作符（==）

相等操作符会对操作值进行隐式转换后进行比较：
（1）如果一个操作值为布尔值，则在比较之前先将其转换为数值
（2）如果一个操作值为字符串，另一个操作值为数值，则通过 Number()函数将字符串转换为数值
（3）如果一个操作值是对象（包括数组，对象所有的引用类型的值），另一个不是，则调用对象的 valueOf()方法（toString()），得到的结果按照前面的规则进行比较
（4）null 与 undefined 是互相相等的，与其他均不相等。
（5）如果一个操作值为 NaN，则相等比较返回 false
（6）如果两个操作值都是对象，则比较它们是不是指向同一个对象

举例说明：

'1'==1.0 // true

'12.10'==12.1 // true

`[1,2,NaN].indexOf(NaN) // -1`

`[1,2,NaN].includes(NaN) // true`

`[1,2]+[3,4] == "1,23,4"`

`[1,2,{}] == "1,2,[object, Object]"`

`[]+[] == ''`

[]+{} == '[object Object]'

{}+{} == NaN （在 firefox 中，javascript 把第一个{}解释成空的代码块，并忽略了它，NaN 其实就是+{}的计算结果，这里的+号不是二元运算符，而是一元运算符，作用是将它后面的操作数转换成数字）

`{}+{} == "[object Object][object object]"`

+"3.65" == 3.65

`++[[]][+[]]+[+[]] == '10'`

`[]==false// true`
`!![]==true// true`
`!!''==false// true`
`[1]=='1'// true`
`''==0// true`
`''==false// true`
`[1]==true// true`
`null==0// false`
`null==''// false`

|   -   | 比较场景                    | 结果                         | 说明                                                                                  |
| :---: | :-------------------------- | :--------------------------- | :------------------------------------------------------------------------------------ |
|   1   | 两边类型相同                | 同全等(===)规则              | (值类型)类型相同，值相等true<br/>(引用类型)引用同一对象才为true                       |
|   2   | `null`与`undefined`         | true                         |                                                                                       |
|   3   | `Number`与`String`          | number == `toNumber(string)` | `0==''`// true<br/>'01'==1 // true                                                    |
|   4   | `Boolean`和`(any)`          | toNumber(bool)==(any)        | true==1// true<br/>false==0//true<br/>false==''//true                                 |
|   5   | `String`/`Number`与`Object` | x == toPrimitive(object)     | "[object Object]" == {} // true <br/> 1 == { valueOf: function(){return "1"}} // true |
|   6   | 其它情况                    | false                        | 0 == null <br/> "" == undefined<br/> undefined == {}                                  |
toPrimitive规则：
优先调用对象的`valueOf`方法转换，如果对象没有`valueOf`方法，或者`valueOf`方法返回的值不是原数据类型，则调用`toString`方法转换。

### 逻辑赋值运算符
加法赋值`+=`  减法赋值`-=`  乘法赋值`*=`
ES2021增加了对逻辑运算符`&&`，`||`，`??`（空值合并）的支持

```
&&=

x &&= y  => x = x && y;
=> if(x) x = y;else x = x;

||=

x ||= y => x = x || y;
=> if(x) x= x;else x = y;

??=

x ??= y => x = x ?? y
=> if(x == null || a = undefined) x = y; x = x;
```
#### ES2020引入新的判断运算符`??`，只有运算符左侧的值为`null`或`undefined`时，才会返回右侧的值。

- 跟链判断运算符`?.`配合使用，为`null`或`undefined`的值设置默认值
```js
const animationDuration = response.settings?.animationDuration??300;
```
- 适合判断函数参数是否赋值
```js
function Component(props){
  let enable = props.enable??true;
}

===>
function Component(props){
  let { enable: enable = true } = props;
}
```
- 优先级：多个逻辑运算符（`&&`和`||`）一起使用，必须用括号表明优先级，否则报错。
```
// 报错
lhs && middle ?? rhs
lhs ?? middle && rhs
lhs || middle ?? rhs
lhs ?? middle || rhs
```
#### 链判断运算符
`?.`运算符，直接在链式调用的时候判断，左侧的对象是否为`null`或`undefined`。如果是的，就不再往下运算，而是返回`undefined`。
链判断运算有三种用法：
- `obj?.prop` 对象属性
- `obj?.[exp]` 对象属性
- `func?.(...args)`  函数或对象方法的调用

```js
let hex = "#C0FFEE".match(/#(A-Z)+/i)?.[1];

a?.b  ==> a==null ? undefined : a.b;

a?.[b] ==> a==null? undefined : a.b;

a?.b() ==> a==null? undefined : a.b()

a?.() ==> a==null? undefined : a()
```
后两种，如果`a?.b()`里面的`a.b`不是函数，不可调用，那么`a?.b()`是会报错的。`a?.()`也是如此，如果`a`不是`null`或`undefined`，但也不是函数，那么`a?.()`会报错。

> 短路机制

`?.`运算符相当于一种短路机制，只要不满足条件，就不再往下执行。
```js
a?.[++x]
// 等同于
a == null ? undefined : a[++x]
```
如果`a`是`undefined`或`null`，那么`x`不会进行递增运算，也就是说，链判断运算符一旦为真，右侧的表达式就不再求值。

> delete 运算符

```js
delete a?.b
// 等同于
a == null ? undefined : delete a.b
```

> 括号的影响

如果属性链有圆括号，链判断运算符对圆括号外部没有影响，只对圆括号内部有影响。一般情况下，使用`?.`运算符的场合，不应该使用圆括号。
```js
(a?.b).c
// 等同于
(a == null ? undefined : a.b).c
```
> 报错场合

以下写法禁止，会报错。
```js
// 构造函数
new a?.()
new a?.b()

// 链判断运算符的右侧有模板字符串
a?.`{b}`
a?.b`{c}`

// 链判断运算符的右侧是super
super?.()
super?.foo

// 链运算符用于复制运算符的左侧
a?.b = c
```
> 右侧不得是十进制数值

允许`foo?.3:0`被解析成`foo ? .3 : 0`，因此规定如果`?.`后面紧跟一个十进制数字，那么`?.`不再被看成一个完整的运算符，会按照三元运算符进行处理。

